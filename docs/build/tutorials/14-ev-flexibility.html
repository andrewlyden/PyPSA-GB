
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Electric Vehicle Flexibility &#8212; PyPSA-GB 2.0.0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=95747493" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=51b770b3"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'tutorials/14-ev-flexibility';</script>
    <script src="../_static/gurubase-widget.js?v=aa0a349d"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Demand Side Response" href="15-demand-side-response.html" />
    <link rel="prev" title="Heat Pump Flexibility" href="13-heat-flexibility.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">PyPSA-GB</p>
  
</a></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../getting_started/index.html">
    Getting Started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../user_guide/index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../data_reference/index.html">
    Data Reference
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    Tutorials
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../api/index.html">
    API Reference
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../development/index.html">
    Development
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../getting_started/index.html">
    Getting Started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../user_guide/index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../data_reference/index.html">
    Data Reference
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api/index.html">
    API Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../development/index.html">
    Development
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">Scenario Tutorials</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="1-historical-baseload-2015.html">Historical Baseload</a></li>
<li class="toctree-l1"><a class="reference internal" href="2-historical-renewables-2023.html">Historical Renewables Era</a></li>
<li class="toctree-l1"><a class="reference internal" href="3-future-holistic-transition-2035.html">Future Scenario: Holistic Transition (2035)</a></li>
<li class="toctree-l1"><a class="reference internal" href="4-future-electric-engagement-2050.html">Future Scenario: Electric Engagement (2050)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Component Tutorials</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="5-networks.html">Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="6-demand.html">Demand</a></li>
<li class="toctree-l1"><a class="reference internal" href="7-generators.html">Generators</a></li>
<li class="toctree-l1"><a class="reference internal" href="8-marginal-costs.html">Marginal Costs</a></li>
<li class="toctree-l1"><a class="reference internal" href="9-renewables.html">Renewable Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="10-storage.html">Storage Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="11-interconnectors.html">Interconnectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="12-hydrogen.html">Hydrogen Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="13-heat-flexibility.html">Heat Pump Flexibility</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Electric Vehicle Flexibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="15-demand-side-response.html">Demand Side Response</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Tutorials</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Electric...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<style>
    /* Hide code cells by default, show on click */
    div.nbinput.container {
        display: none;
    }
    div.nbinput.container.show {
        display: block;
    }
    /* Add toggle button styling */
    .toggle-button {
        background-color: #7ba591;
        color: white;
        padding: 6px 16px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        margin: 10px 0;
        font-size: 0.9em;
        transition: all 0.2s ease;
        box-shadow: 0 2px 4px rgba(123, 165, 145, 0.2);
    }
    .toggle-button:hover {
        background-color: #93c4ab;
        box-shadow: 0 3px 6px rgba(123, 165, 145, 0.3);
        transform: translateY(-1px);
    }
    /* Hide "Data type cannot be displayed" messages */
    .nboutput p:has-text("Data type cannot be displayed") {
        display: none;
    }
</style>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Add toggle buttons for code cells
        var codeCells = document.querySelectorAll('div.nbinput.container');
        codeCells.forEach(function(cell, index) {
            var button = document.createElement('button');
            button.className = 'toggle-button';
            button.textContent = 'Show Code';
            button.onclick = function() {
                if (cell.classList.contains('show')) {
                    cell.classList.remove('show');
                    button.textContent = 'Show Code';
                } else {
                    cell.classList.add('show');
                    button.textContent = 'Hide Code';
                }
            };
            cell.parentNode.insertBefore(button, cell);
        });

        // Hide "Data type cannot be displayed" messages
        var outputs = document.querySelectorAll('.nboutput p');
        outputs.forEach(function(p) {
            if (p.textContent.includes('Data type cannot be displayed')) {
                p.style.display = 'none';
            }
        });
    });
</script><section id="Electric-Vehicle-Flexibility">
<h1>Electric Vehicle Flexibility<a class="headerlink" href="#Electric-Vehicle-Flexibility" title="Link to this heading">#</a></h1>
<p>This tutorial demonstrates how PyPSA-GB models electric vehicle (EV) demand flexibility, including smart charging, Vehicle-to-Grid (V2G), and different tariff behaviors.</p>
<p>The HT35_flex scenario uses <strong>``flex_share = 0.2``</strong>, meaning:</p>
<ul class="simple">
<li><p><strong>20% of EV demand</strong> → Smart charging (optimizable, Store + Link components)</p></li>
<li><p><strong>80% of EV demand</strong> → Dumb loads (fixed evening-peak profile, merged into base electricity)</p></li>
</ul>
<p>This reflects the reality that only a fraction of EV owners have smart chargers or participate in flexibility programs.</p>
<p><strong>Hardware capacities</strong> (chargers, batteries, V2G) come directly from <strong>FES building blocks</strong> (Srg_BB005 for V2G, Srg_BB007a for smart charging).</p>
<section id="What-You'll-Learn.">
<h2>What You’ll Learn.<a class="headerlink" href="#What-You'll-Learn." title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>How <code class="docutils literal notranslate"><span class="pre">flex_share</span></code> splits EV demand between flexible and inflexible. Analyzing charging patterns, V2G dispatch, and battery state of charge</p></li>
<li><p>The four tariff modes (GO, INT, V2G, MIXED) and their PyPSA implementations</p></li>
</ol>
</section>
<section id="1.-Setup">
<h2>1. Setup<a class="headerlink" href="#1.-Setup" title="Link to this heading">#</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pypsa</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;seaborn-v0_8-whitegrid&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PyPSA version: </span><span class="si">{</span><span class="n">pypsa</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
PyPSA version: 1.0.7
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check scenario configuration</span>
<span class="kn">import</span> <span class="nn">yaml</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;../../../config/defaults.yaml&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;../../../config/scenarios.yaml&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">scenarios</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="n">ev_defaults</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;demand_flexibility&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;electric_vehicles&#39;</span><span class="p">,</span> <span class="p">{})</span>
<span class="n">scenario_ev</span> <span class="o">=</span> <span class="n">scenarios</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HT35_flex&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;demand_flexibility&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;electric_vehicles&#39;</span><span class="p">,</span> <span class="p">{})</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">70</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;HT35_FLEX SCENARIO CONFIGURATION&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">70</span><span class="p">)</span>

<span class="c1"># Key parameters</span>
<span class="n">eff_flex_share</span> <span class="o">=</span> <span class="n">scenario_ev</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flex_share&#39;</span><span class="p">,</span> <span class="n">ev_defaults</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flex_share&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
<span class="n">eff_tariff</span> <span class="o">=</span> <span class="n">scenario_ev</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tariff&#39;</span><span class="p">,</span> <span class="n">ev_defaults</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tariff&#39;</span><span class="p">,</span> <span class="s1">&#39;INT&#39;</span><span class="p">))</span>
<span class="n">use_fes</span> <span class="o">=</span> <span class="n">ev_defaults</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;v2g&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;use_fes_capacity&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEMAND SPLIT (flex_share)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  flex_share = </span><span class="si">{</span><span class="n">eff_flex_share</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ├─ </span><span class="si">{</span><span class="n">eff_flex_share</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">% flexible   → Smart charging (Store + Link components)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  └─ </span><span class="si">{</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">eff_flex_share</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">% inflexible → Dumb loads (merged into &#39;electricity&#39;)&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TARIFF MODE&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  tariff = &#39;</span><span class="si">{</span><span class="n">eff_tariff</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">eff_tariff</span> <span class="o">==</span> <span class="s1">&#39;MIXED&#39;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  └─ Splits flexible demand across GO/INT/V2G using FES data&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  └─ All flexible EVs use </span><span class="si">{</span><span class="n">eff_tariff</span><span class="si">}</span><span class="s2"> tariff&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CAPACITY SOURCE&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  use_fes_capacity = </span><span class="si">{</span><span class="n">use_fes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">use_fes</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ├─ V2G:            FES Srg_BB005 (~17.9 GW for HT 2035)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ├─ Smart charging: FES Srg_BB007a&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  └─ Scaled by:      flex_share × tariff mode shares&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  └─ Calculated from fleet size × charger power&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;OTHER SETTINGS&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  battery_capacity_kwh:  </span><span class="si">{</span><span class="n">ev_defaults</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;battery_capacity_kwh&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">60</span><span class="p">)</span><span class="si">}</span><span class="s2"> kWh (average EV battery)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  charge_efficiency:     </span><span class="si">{</span><span class="n">ev_defaults</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;charge_efficiency&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">0.9</span><span class="p">)</span><span class="si">}</span><span class="s2"> (grid-to-battery)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  charger_power_kw:      </span><span class="si">{</span><span class="n">ev_defaults</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;charger_power_kw&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">)</span><span class="si">}</span><span class="s2"> kW (home charger)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">70</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
======================================================================
HT35_FLEX SCENARIO CONFIGURATION
======================================================================
DEMAND SPLIT (flex_share)
  flex_share = 0.2
  ├─ 20% flexible   → Smart charging (Store + Link components)
  └─ 80% inflexible → Dumb loads (merged into &#39;electricity&#39;)
TARIFF MODE
  tariff = &#39;MIXED&#39;
  └─ Splits flexible demand across GO/INT/V2G using FES data
CAPACITY SOURCE
  use_fes_capacity = True
  ├─ V2G:            FES Srg_BB005 (~17.9 GW for HT 2035)
  ├─ Smart charging: FES Srg_BB007a
  └─ Scaled by:      flex_share × tariff mode shares
OTHER SETTINGS
  battery_capacity_kwh:  60.0 kWh (average EV battery)
  charge_efficiency:     0.9 (grid-to-battery)
  charger_power_kw:      7.0 kW (home charger)

======================================================================
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check all load carriers in the network to find where the 80% dumb EV demand went</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">pypsa</span><span class="o">.</span><span class="n">Network</span><span class="p">(</span><span class="s2">&quot;../../../resources/network/HT35_flex_solved.nc&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ALL LOAD CARRIERS IN NETWORK:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
<span class="k">for</span> <span class="n">carrier</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">loads</span><span class="o">.</span><span class="n">carrier</span><span class="o">.</span><span class="n">unique</span><span class="p">()):</span>
    <span class="n">loads_c</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">loads</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">loads</span><span class="o">.</span><span class="n">carrier</span> <span class="o">==</span> <span class="n">carrier</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">loads_t</span><span class="o">.</span><span class="n">p_set</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">loads_c</span><span class="o">.</span><span class="n">index</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">total</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">loads_t</span><span class="o">.</span><span class="n">p_set</span><span class="p">[</span><span class="n">loads_c</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">loads_t</span><span class="o">.</span><span class="n">p_set</span><span class="o">.</span><span class="n">columns</span><span class="p">)]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span>  <span class="c1"># GWh</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">carrier</span><span class="si">:</span><span class="s2">30s</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">loads_c</span><span class="p">)</span><span class="si">:</span><span class="s2">&gt;5</span><span class="si">}</span><span class="s2"> loads, </span><span class="si">{</span><span class="n">total</span><span class="si">:</span><span class="s2">&gt;10.1f</span><span class="si">}</span><span class="s2"> GWh&quot;</span><span class="p">)</span>

<span class="c1"># Also check: what fraction of total demand is EV driving?</span>
<span class="n">ev_driving</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">loads</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">loads</span><span class="o">.</span><span class="n">carrier</span> <span class="o">==</span> <span class="s1">&#39;EV driving&#39;</span><span class="p">]</span>
<span class="n">ev_demand</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">loads_t</span><span class="o">.</span><span class="n">p_set</span><span class="p">[</span><span class="n">ev_driving</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span>  <span class="c1"># GWh</span>

<span class="n">elec_loads</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">loads</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">loads</span><span class="o">.</span><span class="n">carrier</span> <span class="o">==</span> <span class="s1">&#39;electricity&#39;</span><span class="p">]</span>
<span class="n">elec_demand</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">loads_t</span><span class="o">.</span><span class="n">p_set</span><span class="p">[</span><span class="n">elec_loads</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span>  <span class="c1"># GWh</span>

<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DEMAND BREAKDOWN:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Base electricity:  </span><span class="si">{</span><span class="n">elec_demand</span><span class="si">:</span><span class="s2">&gt;10.1f</span><span class="si">}</span><span class="s2"> GWh&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  EV driving (flex): </span><span class="si">{</span><span class="n">ev_demand</span><span class="si">:</span><span class="s2">&gt;10.1f</span><span class="si">}</span><span class="s2"> GWh&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total:             </span><span class="si">{</span><span class="n">elec_demand</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ev_demand</span><span class="si">:</span><span class="s2">&gt;10.1f</span><span class="si">}</span><span class="s2"> GWh&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:pypsa.network.io:Imported network &#39;HT35_flex (Clustered)&#39; has buses, carriers, generators, lines, links, loads, storage_units, stores, sub_networks
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ALL LOAD CARRIERS IN NETWORK:
------------------------------------------------------------
  EV driving                    :   936 loads,      246.7 GWh
  electricity                   :   251 loads,     6013.5 GWh

DEMAND BREAKDOWN:
  Base electricity:      6013.5 GWh
  EV driving (flex):      246.7 GWh
  Total:                 6260.2 GWh
</pre></div></div>
</div>
</section>
<section id="2.-Background:-Why-EV-Flexibility-Matters">
<h2>2. Background: Why EV Flexibility Matters<a class="headerlink" href="#2.-Background:-Why-EV-Flexibility-Matters" title="Link to this heading">#</a></h2>
<p>Electric vehicles represent a major new source of electricity demand in Great Britain. By 2035, FES projects EVs could add 30-60 TWh of electricity demand annually. However, unlike traditional loads, EVs have inherent flexibility:</p>
<ul class="simple">
<li><p><strong>Battery storage</strong>: EVs have large batteries (40-100 kWh) that only need partial daily recharge</p></li>
<li><p><strong>Plug-in time &gt;&gt; Charging time</strong>: Cars parked 95% of day, charging takes 4-8 hours</p></li>
<li><p><strong>Predictable patterns</strong>: Regular commuting creates predictable demand and availability</p></li>
</ul>
<p><strong>Flexibility value comes from:</strong></p>
<ol class="arabic simple">
<li><p><strong>Peak shaving</strong>: Avoiding expensive evening demand peaks (£100-200/MWh)</p></li>
<li><p><strong>Renewable integration</strong>: Charging when wind/solar abundant (£30-50/MWh)</p></li>
<li><p><strong>Grid services (V2G)</strong>: Providing balancing during stress (£100-300/MWh)</p></li>
<li><p><strong>Transmission relief</strong>: Temporal load distribution reduces network congestion</p></li>
</ol>
<section id="2.1-How-PyPSA-GB-Models-EV-Flexibility">
<h3>2.1 How PyPSA-GB Models EV Flexibility<a class="headerlink" href="#2.1-How-PyPSA-GB-Models-EV-Flexibility" title="Link to this heading">#</a></h3>
<p>PyPSA-GB uses <strong>``flex_share``</strong> to split EV demand into two groups:</p>
<ul class="simple">
<li><p><strong>Flexible EVs</strong> (20% with <code class="docutils literal notranslate"><span class="pre">flex_share=0.2</span></code>): Modeled as <strong>Store + Link</strong> components that can optimize charging timing</p></li>
<li><p><strong>Inflexible EVs</strong> (80%): Modeled as fixed <strong>Load</strong> components with evening-peak profile</p></li>
</ul>
<p>Hardware capacities (chargers, batteries, V2G) come from <strong>FES building blocks</strong> (Srg_BB005, Srg_BB007a), not calculated from fleet size.</p>
</section>
<section id="2.2-Four-EV-Tariff-Modes">
<h3>2.2 Four EV Tariff Modes<a class="headerlink" href="#2.2-Four-EV-Tariff-Modes" title="Link to this heading">#</a></h3>
<p>PyPSA-GB models four EV flexibility mechanisms, each representing different consumer behaviors:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Mode</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>PyPSA Implementation</p></th>
<th class="head"><p>Flexibility Level</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>GO</strong></p></td>
<td><p>Fixed night window (Octopus Go style)</p></td>
<td><p>Store + Link (cost-incentivized)</p></td>
<td><p>Low (time-shifted only)</p></td>
</tr>
<tr class="row-odd"><td><p><strong>INT</strong></p></td>
<td><p>Intelligent smart charging</p></td>
<td><p>Store + Link (charge only)</p></td>
<td><p>Medium (fully optimizable)</p></td>
</tr>
<tr class="row-even"><td><p><strong>V2G</strong></p></td>
<td><p>Vehicle-to-Grid bidirectional</p></td>
<td><p>Store + 2 Links (charge/discharge)</p></td>
<td><p>High (includes grid export)</p></td>
</tr>
<tr class="row-odd"><td><p><strong>MIXED</strong></p></td>
<td><p>Splits fleet across GO/INT/V2G</p></td>
<td><p>All of the above</p></td>
<td><p>Realistic heterogeneity</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Note</strong>: These tariffs only apply to the <strong>flexible portion</strong> (20% with <code class="docutils literal notranslate"><span class="pre">flex_share=0.2</span></code>). The remaining 80% are dumb loads regardless of tariff mode.</p>
<section id="GO-Mode-(Octopus-Go-Style)">
<h4>GO Mode (Octopus Go Style)<a class="headerlink" href="#GO-Mode-(Octopus-Go-Style)" title="Link to this heading">#</a></h4>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Grid ──▶ [Charging Window 00:00-04:00] ──▶ EV Battery ──▶ Driving
          (Cost-incentivized)
</pre></div>
</div>
<ul class="simple">
<li><p>Simple time-of-use tariff with cheap overnight rates</p></li>
<li><p>Charging incentivized during window (£0/MWh) vs outside (£100/MWh)</p></li>
<li><p>Low flexibility: shifts load to fixed window</p></li>
</ul>
</section>
<section id="INT-Mode-(Intelligent-Tariff)">
<h4>INT Mode (Intelligent Tariff)<a class="headerlink" href="#INT-Mode-(Intelligent-Tariff)" title="Link to this heading">#</a></h4>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>                  efficiency
Grid ──▶ [EV Charger Link] ──▶ [EV Battery Store] ──▶ Driving
                90%              (SOC tracking)        (Load)
</pre></div>
</div>
<ul class="simple">
<li><p>Smart charging optimizes <strong>when</strong> to charge within plugged-in hours</p></li>
<li><p>Store tracks battery state of charge (SOC)</p></li>
<li><p>Minimum SOC constraint (20%) ensures range availability</p></li>
<li><p>Target departure SOC (80% at 7am)</p></li>
</ul>
</section>
<section id="V2G-Mode-(Vehicle-to-Grid)">
<h4>V2G Mode (Vehicle-to-Grid)<a class="headerlink" href="#V2G-Mode-(Vehicle-to-Grid)" title="Link to this heading">#</a></h4>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>                  90%                                    90%
Grid ──▶ [EV Charger] ──▶ [EV Battery Store] ◀── [V2G Discharge] ◀── Grid
          (Link)            (SOC tracking)         (Link)         (export)
                                   │
                                   ▼
                            Driving (Load)
</pre></div>
</div>
<ul class="simple">
<li><p>Bidirectional - EVs can charge <strong>and</strong> discharge to grid</p></li>
<li><p>V2G capacity from FES Srg_BB005 (17.9 GW by 2035 in HT scenario)</p></li>
<li><p>Battery degradation cost (£50/MWh) discourages excessive cycling</p></li>
<li><p>Provides grid balancing during stress periods</p></li>
</ul>
</section>
<section id="MIXED-Mode-(HT35_flex-uses-this)">
<h4>MIXED Mode (HT35_flex uses this)<a class="headerlink" href="#MIXED-Mode-(HT35_flex-uses-this)" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p>Splits flexible fleet across GO/INT/V2G based on FES data</p></li>
<li><p>GO share: Non-smart chargers (lowest flexibility)</p></li>
<li><p>INT share: Smart chargers without V2G</p></li>
<li><p>V2G share: Bidirectional chargers (highest flexibility)</p></li>
<li><p>Creates separate component sets for each tariff type at each bus</p></li>
</ul>
</section>
</section>
</section>
<section id="3.-Load-a-Network-with-EV-Flexibility">
<h2>3. Load a Network with EV Flexibility<a class="headerlink" href="#3.-Load-a-Network-with-EV-Flexibility" title="Link to this heading">#</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load a solved network with EV flexibility enabled</span>
<span class="c1"># HT35_flex: 2035 Holistic Transition with MIXED tariff and flex_share=0.2</span>
<span class="c1"># Only 20% of EV demand participates in flexibility (GO/INT/V2G)</span>
<span class="c1"># The remaining 80% is embedded in the base &#39;electricity&#39; loads</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">pypsa</span><span class="o">.</span><span class="n">Network</span><span class="p">(</span><span class="s2">&quot;../../../resources/network/HT35_flex_solved.nc&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Network loaded&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Buses: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">buses</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Loads: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">loads</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Links: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">links</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Stores: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">stores</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Snapshots: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">snapshots</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Period: </span><span class="si">{</span><span class="n">n</span><span class="o">.</span><span class="n">snapshots</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">n</span><span class="o">.</span><span class="n">snapshots</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:pypsa.network.io:Imported network &#39;HT35_flex (Clustered)&#39; has buses, carriers, generators, lines, links, loads, storage_units, stores, sub_networks
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Network loaded
  Buses: 1234
  Loads: 1187
  Links: 1530
  Stores: 937
  Snapshots: 168
  Period: 2035-01-13 00:00:00 to 2035-01-19 23:00:00
</pre></div></div>
</div>
</section>
<section id="4.-EV-Components-in-the-Network">
<h2>4. EV Components in the Network<a class="headerlink" href="#4.-EV-Components-in-the-Network" title="Link to this heading">#</a></h2>
<section id="4.1-Identifying-EV-Components">
<h3>4.1 Identifying EV Components<a class="headerlink" href="#4.1-Identifying-EV-Components" title="Link to this heading">#</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># EV components are identified by their carrier</span>

<span class="c1"># EV Battery Stores (track SOC)</span>
<span class="n">ev_stores</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">stores</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">stores</span><span class="p">[</span><span class="s1">&#39;carrier&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;EV battery&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;EV Battery Stores: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">ev_stores</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># EV Charger Links (grid → battery)</span>
<span class="n">ev_chargers</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">links</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">links</span><span class="p">[</span><span class="s1">&#39;carrier&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;EV charger&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;EV Charger Links: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">ev_chargers</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># V2G Links (battery → grid) - only present in V2G mode</span>
<span class="n">v2g_links</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">links</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">links</span><span class="p">[</span><span class="s1">&#39;carrier&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;V2G&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;V2G Links: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">v2g_links</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># EV Driving Loads (electricity demand for driving)</span>
<span class="n">ev_loads</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">loads</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">loads</span><span class="p">[</span><span class="s1">&#39;carrier&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;EV driving&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;EV Driving Loads: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">ev_loads</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Show sample components</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ev_stores</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Sample EV Battery Stores:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ev_stores</span><span class="p">[[</span><span class="s1">&#39;bus&#39;</span><span class="p">,</span> <span class="s1">&#39;carrier&#39;</span><span class="p">,</span> <span class="s1">&#39;e_nom&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v2g_links</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Sample V2G Links:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">v2g_links</span><span class="p">[[</span><span class="s1">&#39;bus0&#39;</span><span class="p">,</span> <span class="s1">&#39;bus1&#39;</span><span class="p">,</span> <span class="s1">&#39;carrier&#39;</span><span class="p">,</span> <span class="s1">&#39;p_nom&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
EV Battery Stores: 936
EV Charger Links: 936
V2G Links: 312
EV Driving Loads: 936

Sample EV Battery Stores:
                                                          bus     carrier  \
name
CLAC1Q EV fleet battery GO    EV battery_CLAC1Q EV battery GO  EV battery
CLAC1Q EV fleet battery INT  EV battery_CLAC1Q EV battery INT  EV battery
CLAC1Q EV fleet battery V2G  EV battery_CLAC1Q EV battery V2G  EV battery
DUNO1Q EV fleet battery GO    EV battery_DUNO1Q EV battery GO  EV battery
DUNO1Q EV fleet battery INT  EV battery_DUNO1Q EV battery INT  EV battery

                             e_nom
name
CLAC1Q EV fleet battery GO   0.960
CLAC1Q EV fleet battery INT  1.608
CLAC1Q EV fleet battery V2G  0.636
DUNO1Q EV fleet battery GO   0.708
DUNO1Q EV fleet battery INT  1.188

Sample V2G Links:
                                        bus0  \
name
CLAC1Q V2G  EV battery_CLAC1Q EV battery V2G
DUNO1Q V2G  EV battery_DUNO1Q EV battery V2G
DUNO1R V2G  EV battery_DUNO1R EV battery V2G
KEIT3- V2G  EV battery_KEIT3- EV battery V2G
QUOI1- V2G  EV battery_QUOI1- EV battery V2G

                                          bus1 carrier   p_nom
name
CLAC1Q V2G                       ARDK_P|CLAC_P     V2G  0.0742
DUNO1Q V2G                              DUNO_P     V2G  0.0546
DUNO1R V2G                              DUNO_P     V2G  0.0546
KEIT3- V2G  BERB_P|CAIF_P|DALL_P|GLEF_P|KEIT_P     V2G  0.3850
QUOI1- V2G                              QUOI_P     V2G  0.0028
</pre></div></div>
</div>
</section>
<section id="4.2-EV-Capacity-Summary">
<h3>4.2 EV Capacity Summary<a class="headerlink" href="#4.2-EV-Capacity-Summary" title="Link to this heading">#</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Summarize EV capacity in the network</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;EV FLEET CAPACITY SUMMARY&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ev_stores</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">total_battery_gwh</span> <span class="o">=</span> <span class="n">ev_stores</span><span class="p">[</span><span class="s1">&#39;e_nom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">EV Battery Storage:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total capacity: </span><span class="si">{</span><span class="n">total_battery_gwh</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> GWh&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Number of buses: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">ev_stores</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Average per bus: </span><span class="si">{</span><span class="n">ev_stores</span><span class="p">[</span><span class="s1">&#39;e_nom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> MWh&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ev_chargers</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">total_charge_gw</span> <span class="o">=</span> <span class="n">ev_chargers</span><span class="p">[</span><span class="s1">&#39;p_nom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">EV Charging Capacity:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total charging power: </span><span class="si">{</span><span class="n">total_charge_gw</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> GW&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Number of chargers: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">ev_chargers</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v2g_links</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">total_v2g_gw</span> <span class="o">=</span> <span class="n">v2g_links</span><span class="p">[</span><span class="s1">&#39;p_nom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">V2G Discharge Capacity:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total V2G power: </span><span class="si">{</span><span class="n">total_v2g_gw</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> GW&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Number of V2G-enabled buses: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">v2g_links</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Note: V2G capacity is scaled by flex_share AND the V2G share of MIXED mode&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  FES Srg_BB005 full target: ~17.9 GW (before flex_share/mode splitting)&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ev_loads</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="c1"># Driving demand on EV battery buses (flex_share fraction only)</span>
    <span class="n">total_ev_demand_gwh</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">loads_t</span><span class="o">.</span><span class="n">p_set</span><span class="p">[</span><span class="n">ev_loads</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">EV Driving Demand (flexible portion):&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Weekly energy: </span><span class="si">{</span><span class="n">total_ev_demand_gwh</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> GWh&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  The remaining </span><span class="si">{</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">eff_flex_share</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">% is embedded in &#39;electricity&#39; loads&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  This is flex_share=</span><span class="si">{</span><span class="n">eff_flex_share</span><span class="si">}</span><span class="s2"> of total EV demand&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
============================================================
EV FLEET CAPACITY SUMMARY
============================================================

EV Battery Storage:
  Total capacity: 21.15 GWh
  Number of buses: 936
  Average per bus: 22.6 MWh

EV Charging Capacity:
  Total charging power: 2.47 GW
  Number of chargers: 936

V2G Discharge Capacity:
  Total V2G power: 0.49 GW
  Number of V2G-enabled buses: 312
  Note: V2G capacity is scaled by flex_share AND the V2G share of MIXED mode
  FES Srg_BB005 full target: ~17.9 GW (before flex_share/mode splitting)

EV Driving Demand (flexible portion):
  Weekly energy: 246.7 GWh
  The remaining 80% is embedded in &#39;electricity&#39; loads
  This is flex_share=0.2 of total EV demand
</pre></div></div>
</div>
</section>
</section>
<section id="5.-EV-Availability-Profile">
<h2>5. EV Availability Profile<a class="headerlink" href="#5.-EV-Availability-Profile" title="Link to this heading">#</a></h2>
<p>EV availability for charging follows GB traffic patterns - EVs are available when parked (inverse of traffic). This creates:</p>
<ul class="simple">
<li><p><strong>High availability overnight</strong>: ~95% plugged in (00:00-06:00)</p></li>
<li><p><strong>Morning dip</strong>: ~50% plugged in during commute (07:00-09:00)</p></li>
<li><p><strong>Daytime recovery</strong>: ~75% plugged in (10:00-16:00)</p></li>
<li><p><strong>Evening dip</strong>: ~60% plugged in during commute (17:00-19:00)</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The availability is encoded in the charger Link&#39;s p_max_pu time series</span>
<span class="c1"># This limits charging to when EVs are plugged in</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ev_chargers</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">links_t</span><span class="o">.</span><span class="n">p_max_pu</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="c1"># Get availability for one charger</span>
    <span class="n">sample_charger</span> <span class="o">=</span> <span class="n">ev_chargers</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">sample_charger</span> <span class="ow">in</span> <span class="n">n</span><span class="o">.</span><span class="n">links_t</span><span class="o">.</span><span class="n">p_max_pu</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">avail</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">links_t</span><span class="o">.</span><span class="n">p_max_pu</span><span class="p">[</span><span class="n">sample_charger</span><span class="p">]</span>

        <span class="c1"># Average by hour of day</span>
        <span class="n">avail_by_hour</span> <span class="o">=</span> <span class="n">avail</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">avail</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

        <span class="c1"># Time series (first week)</span>
        <span class="n">week</span> <span class="o">=</span> <span class="n">avail</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">168</span><span class="p">]</span>  <span class="c1"># First week</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">week</span><span class="p">)),</span> <span class="n">week</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">week</span><span class="p">)),</span> <span class="n">week</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Availability (fraction plugged in)&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Hour of week&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;EV Availability - First Week&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">)</span>

        <span class="c1"># Average daily profile</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">avail_by_hour</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">avail_by_hour</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Average availability&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Hour of day&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Average Daily EV Availability Profile&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Availability Statistics:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Mean: </span><span class="si">{</span><span class="n">avail</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Min: </span><span class="si">{</span><span class="n">avail</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> (peak commute)&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Max: </span><span class="si">{</span><span class="n">avail</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> (overnight)&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No availability time series found - check network configuration&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_14-ev-flexibility_15_0.png" src="../_images/tutorials_14-ev-flexibility_15_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Availability Statistics:
  Mean: 0.80
  Min: 0.66 (peak commute)
  Max: 0.95 (overnight)
</pre></div></div>
</div>
</section>
<section id="6.-Analyzing-EV-Charging-Behavior">
<h2>6. Analyzing EV Charging Behavior<a class="headerlink" href="#6.-Analyzing-EV-Charging-Behavior" title="Link to this heading">#</a></h2>
<section id="6.1-Total-EV-Charging-Profile">
<h3>6.1 Total EV Charging Profile<a class="headerlink" href="#6.1-Total-EV-Charging-Profile" title="Link to this heading">#</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get total EV charging power from charger links</span>
<span class="c1"># p0 is positive when power flows from grid (bus0) to battery (bus1)</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ev_chargers</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">links_t</span><span class="o">.</span><span class="n">p0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">charger_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">n</span><span class="o">.</span><span class="n">links_t</span><span class="o">.</span><span class="n">p0</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">ev_chargers</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">charger_cols</span><span class="p">:</span>
        <span class="n">total_charging</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">links_t</span><span class="o">.</span><span class="n">p0</span><span class="p">[</span><span class="n">charger_cols</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span>  <span class="c1"># GW</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;EV Charging Statistics:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Mean charging: </span><span class="si">{</span><span class="n">total_charging</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> GW&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Peak charging: </span><span class="si">{</span><span class="n">total_charging</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> GW&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total energy: </span><span class="si">{</span><span class="n">total_charging</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> GWh&quot;</span><span class="p">)</span>

        <span class="c1"># Plot</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">total_charging</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">total_charging</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">total_charging</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">total_charging</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">total_charging</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                   <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mean: </span><span class="si">{</span><span class="n">total_charging</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> GW&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;EV Charging Power (GW)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Total EV Fleet Charging Power&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
EV Charging Statistics:
  Mean charging: 1.62 GW
  Peak charging: 2.32 GW
  Total energy: 272 GWh
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_14-ev-flexibility_18_1.png" src="../_images/tutorials_14-ev-flexibility_18_1.png" />
</div>
</div>
</section>
<section id="6.2-Daily-Charging-Pattern">
<h3>6.2 Daily Charging Pattern<a class="headerlink" href="#6.2-Daily-Charging-Pattern" title="Link to this heading">#</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Average charging by hour of day</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ev_chargers</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">links_t</span><span class="o">.</span><span class="n">p0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">charger_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">n</span><span class="o">.</span><span class="n">links_t</span><span class="o">.</span><span class="n">p0</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">ev_chargers</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">charger_cols</span><span class="p">:</span>
        <span class="n">total_charging</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">links_t</span><span class="o">.</span><span class="n">p0</span><span class="p">[</span><span class="n">charger_cols</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span>  <span class="c1"># GW</span>

        <span class="c1"># Group by hour</span>
        <span class="n">charging_by_hour</span> <span class="o">=</span> <span class="n">total_charging</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">total_charging</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

        <span class="c1"># Compare with unmanaged (evening peak) profile</span>
        <span class="c1"># Typical unmanaged charging peaks 17:00-21:00 when people return home</span>
        <span class="n">unmanaged_profile</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span>  <span class="c1"># 00:00-05:00 (overnight, low)</span>
            <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span>  <span class="c1"># 06:00-11:00 (morning)</span>
            <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span>  <span class="c1"># 12:00-17:00 (afternoon)</span>
            <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.4</span>   <span class="c1"># 18:00-23:00 (evening peak)</span>
        <span class="p">])</span>
        <span class="n">unmanaged_scaled</span> <span class="o">=</span> <span class="n">unmanaged_profile</span> <span class="o">*</span> <span class="n">charging_by_hour</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">unmanaged_profile</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

        <span class="n">width</span> <span class="o">=</span> <span class="mf">0.35</span>
        <span class="n">hours</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">hours</span> <span class="o">-</span> <span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">charging_by_hour</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span>
               <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Smart Charging (Optimized)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">hours</span> <span class="o">+</span> <span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">unmanaged_scaled</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span>
               <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Unmanaged (Evening Peak)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Average Charging Power (GW)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Hour of Day&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Smart Charging vs Unmanaged Charging Profile&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">hours</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="c1"># Calculate peak reduction</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Peak Reduction from Smart Charging:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Unmanaged evening peak: </span><span class="si">{</span><span class="n">unmanaged_scaled</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> GW&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Smart charging peak: </span><span class="si">{</span><span class="n">charging_by_hour</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> GW&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Peak reduction: </span><span class="si">{</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">charging_by_hour</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="n">unmanaged_scaled</span><span class="o">.</span><span class="n">max</span><span class="p">())</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_14-ev-flexibility_20_0.png" src="../_images/tutorials_14-ev-flexibility_20_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Peak Reduction from Smart Charging:
  Unmanaged evening peak: 3.18 GW
  Smart charging peak: 2.16 GW
  Peak reduction: 32.1%
</pre></div></div>
</div>
</section>
</section>
<section id="7.-V2G-Dispatch-Analysis">
<h2>7. V2G Dispatch Analysis<a class="headerlink" href="#7.-V2G-Dispatch-Analysis" title="Link to this heading">#</a></h2>
<p>V2G (Vehicle-to-Grid) allows EVs to discharge back to the grid, providing additional flexibility. The optimizer decides when V2G discharge is valuable based on:</p>
<ul class="simple">
<li><p><strong>System price</strong>: Discharge when electricity prices are high</p></li>
<li><p><strong>Grid stress</strong>: Help during peak demand periods</p></li>
<li><p><strong>Battery degradation</strong>: Cost of cycling discourages excessive V2G use</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Analyze V2G discharge if present</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v2g_links</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">links_t</span><span class="o">.</span><span class="n">p0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">v2g_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">n</span><span class="o">.</span><span class="n">links_t</span><span class="o">.</span><span class="n">p0</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">v2g_links</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">v2g_cols</span><span class="p">:</span>
        <span class="c1"># p0 is positive when power flows from battery to grid</span>
        <span class="n">total_v2g</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">links_t</span><span class="o">.</span><span class="n">p0</span><span class="p">[</span><span class="n">v2g_cols</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span>  <span class="c1"># GW</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;V2G Dispatch Statistics:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total V2G energy: </span><span class="si">{</span><span class="n">total_v2g</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> GWh&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Peak V2G power: </span><span class="si">{</span><span class="n">total_v2g</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> GW&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Hours with V2G &gt; 0: </span><span class="si">{</span><span class="p">(</span><span class="n">total_v2g</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.001</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Compare V2G capacity utilization</span>
        <span class="n">total_v2g_capacity</span> <span class="o">=</span> <span class="n">v2g_links</span><span class="p">[</span><span class="s1">&#39;p_nom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span>  <span class="c1"># GW</span>
        <span class="n">utilization</span> <span class="o">=</span> <span class="n">total_v2g</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">/</span> <span class="n">total_v2g_capacity</span> <span class="o">*</span> <span class="mi">100</span> <span class="k">if</span> <span class="n">total_v2g_capacity</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  V2G capacity: </span><span class="si">{</span><span class="n">total_v2g_capacity</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> GW&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Peak utilization: </span><span class="si">{</span><span class="n">utilization</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

        <span class="c1"># Plot V2G dispatch</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Time series</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">total_v2g</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">total_v2g</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">total_v2g</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">total_v2g</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;V2G Discharge (GW)&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;V2G Discharge to Grid&#39;</span><span class="p">)</span>

        <span class="c1"># By hour of day</span>
        <span class="n">v2g_by_hour</span> <span class="o">=</span> <span class="n">total_v2g</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">total_v2g</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">v2g_by_hour</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">v2g_by_hour</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Average V2G Power (GW)&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Hour of Day&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Average V2G Dispatch by Hour&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No V2G links found - network may be using GO or INT tariff mode&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
V2G Dispatch Statistics:
  Total V2G energy: 0 GWh
  Peak V2G power: 0.00 GW
  Hours with V2G &gt; 0: 0
  V2G capacity: 0.49 GW
  Peak utilization: 0.1%
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_14-ev-flexibility_22_1.png" src="../_images/tutorials_14-ev-flexibility_22_1.png" />
</div>
</div>
<section id="7.1-V2G-Value-Analysis">
<h3>7.1 V2G Value Analysis<a class="headerlink" href="#7.1-V2G-Value-Analysis" title="Link to this heading">#</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># When does V2G discharge? Compare with marginal prices</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v2g_links</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">links_t</span><span class="o">.</span><span class="n">p0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">buses_t</span><span class="o">.</span><span class="n">marginal_price</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">v2g_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">n</span><span class="o">.</span><span class="n">links_t</span><span class="o">.</span><span class="n">p0</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">v2g_links</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">v2g_cols</span><span class="p">:</span>
        <span class="n">total_v2g</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">links_t</span><span class="o">.</span><span class="n">p0</span><span class="p">[</span><span class="n">v2g_cols</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span>  <span class="c1"># GW</span>

        <span class="c1"># Get average marginal price across buses</span>
        <span class="n">avg_price</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">buses_t</span><span class="o">.</span><span class="n">marginal_price</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Create comparison DataFrame</span>
        <span class="n">comparison</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
            <span class="s1">&#39;v2g_gw&#39;</span><span class="p">:</span> <span class="n">total_v2g</span><span class="p">,</span>
            <span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="n">avg_price</span>
        <span class="p">})</span>

        <span class="c1"># Identify V2G active hours</span>
        <span class="n">v2g_active</span> <span class="o">=</span> <span class="n">comparison</span><span class="p">[</span><span class="n">comparison</span><span class="p">[</span><span class="s1">&#39;v2g_gw&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.001</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v2g_active</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;V2G Value Analysis:&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Average price when V2G active: £</span><span class="si">{</span><span class="n">v2g_active</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">/MWh&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Average price overall: £</span><span class="si">{</span><span class="n">avg_price</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">/MWh&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Price premium captured: £</span><span class="si">{</span><span class="n">v2g_active</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">avg_price</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">/MWh&quot;</span><span class="p">)</span>

            <span class="c1"># Plot price vs V2G</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

            <span class="n">ax1</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">comparison</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">comparison</span><span class="p">[</span><span class="s1">&#39;v2g_gw&#39;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;V2G&#39;</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;V2G Discharge (GW)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">)</span>

            <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">comparison</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">comparison</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Marginal Price (£/MWh)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>

            <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;V2G Dispatch vs Marginal Price&#39;</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No V2G dispatch occurred - degradation cost may exceed price arbitrage value&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
No V2G dispatch occurred - degradation cost may exceed price arbitrage value
</pre></div></div>
</div>
</section>
</section>
<section id="8.-Battery-State-of-Charge">
<h2>8. Battery State of Charge<a class="headerlink" href="#8.-Battery-State-of-Charge" title="Link to this heading">#</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Track aggregate EV battery SOC over time</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ev_stores</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">stores_t</span><span class="o">.</span><span class="n">e</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">store_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">n</span><span class="o">.</span><span class="n">stores_t</span><span class="o">.</span><span class="n">e</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">ev_stores</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">store_cols</span><span class="p">:</span>
        <span class="c1"># Total energy stored</span>
        <span class="n">total_soc</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">stores_t</span><span class="o">.</span><span class="n">e</span><span class="p">[</span><span class="n">store_cols</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span>  <span class="c1"># GWh</span>
        <span class="n">total_capacity</span> <span class="o">=</span> <span class="n">ev_stores</span><span class="p">[</span><span class="s1">&#39;e_nom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span>  <span class="c1"># GWh</span>

        <span class="c1"># SOC as percentage</span>
        <span class="n">soc_pct</span> <span class="o">=</span> <span class="n">total_soc</span> <span class="o">/</span> <span class="n">total_capacity</span> <span class="o">*</span> <span class="mi">100</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;EV Fleet Battery Statistics:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total battery capacity: </span><span class="si">{</span><span class="n">total_capacity</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> GWh&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Average SOC: </span><span class="si">{</span><span class="n">soc_pct</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Min SOC: </span><span class="si">{</span><span class="n">soc_pct</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Max SOC: </span><span class="si">{</span><span class="n">soc_pct</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

        <span class="c1"># Plot SOC over time and by hour</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

        <span class="c1"># Time series (first 2 weeks)</span>
        <span class="n">period</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">336</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">soc_pct</span><span class="p">))</span>  <span class="c1"># 2 weeks or available</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">period</span><span class="p">),</span> <span class="n">soc_pct</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">period</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Min SOC (20%)&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Target SOC (80%)&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Fleet SOC (%)&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Hour&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;EV Fleet State of Charge - First 2 Weeks&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

        <span class="c1"># Average by hour of day</span>
        <span class="n">soc_by_hour</span> <span class="o">=</span> <span class="n">soc_pct</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">soc_pct</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">soc_by_hour</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">soc_by_hour</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Target departure SOC&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Average SOC (%)&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Hour of Day&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Average Daily SOC Profile&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
EV Fleet Battery Statistics:
  Total battery capacity: 21.1 GWh
  Average SOC: 64.3%
  Min SOC: 20.3%
  Max SOC: 99.8%
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_14-ev-flexibility_26_1.png" src="../_images/tutorials_14-ev-flexibility_26_1.png" />
</div>
</div>
</section>
<section id="9.-EV-Impact-on-Grid">
<h2>9. EV Impact on Grid<a class="headerlink" href="#9.-EV-Impact-on-Grid" title="Link to this heading">#</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compare EV load with total system load</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ev_chargers</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">links_t</span><span class="o">.</span><span class="n">p0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">charger_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">n</span><span class="o">.</span><span class="n">links_t</span><span class="o">.</span><span class="n">p0</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">ev_chargers</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">charger_cols</span><span class="p">:</span>
        <span class="c1"># EV charging (net of V2G if present)</span>
        <span class="n">ev_charging</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">links_t</span><span class="o">.</span><span class="n">p0</span><span class="p">[</span><span class="n">charger_cols</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span>  <span class="c1"># GW</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v2g_links</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">v2g_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">n</span><span class="o">.</span><span class="n">links_t</span><span class="o">.</span><span class="n">p0</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">v2g_links</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">v2g_cols</span><span class="p">:</span>
                <span class="n">v2g_discharge</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">links_t</span><span class="o">.</span><span class="n">p0</span><span class="p">[</span><span class="n">v2g_cols</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span>  <span class="c1"># GW</span>
                <span class="n">net_ev_load</span> <span class="o">=</span> <span class="n">ev_charging</span> <span class="o">-</span> <span class="n">v2g_discharge</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">net_ev_load</span> <span class="o">=</span> <span class="n">ev_charging</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">net_ev_load</span> <span class="o">=</span> <span class="n">ev_charging</span>

        <span class="c1"># Total system load (from base electricity loads)</span>
        <span class="c1"># Base loads have carrier &#39;electricity&#39; (not empty string)</span>
        <span class="n">base_loads</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">loads</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">loads</span><span class="p">[</span><span class="s1">&#39;carrier&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;electricity&#39;</span><span class="p">]</span>
        <span class="n">base_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">n</span><span class="o">.</span><span class="n">loads_t</span><span class="o">.</span><span class="n">p_set</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">base_loads</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
        <span class="n">total_base_load</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">loads_t</span><span class="o">.</span><span class="n">p_set</span><span class="p">[</span><span class="n">base_cols</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span>  <span class="c1"># GW</span>

        <span class="c1"># Plot comparison</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">total_base_load</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">total_base_load</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                       <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Base Load&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">net_ev_load</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">net_ev_load</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                       <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Net EV Load&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Power (GW)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;EV Impact on Total System Load&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="c1"># Calculate EV share</span>
        <span class="n">ev_share</span> <span class="o">=</span> <span class="n">net_ev_load</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="p">(</span><span class="n">total_base_load</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="n">net_ev_load</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">EV Contribution to Total Load:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  EV share of total energy: </span><span class="si">{</span><span class="n">ev_share</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Peak coincidence factor: </span><span class="si">{</span><span class="n">net_ev_load</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">ev_charging</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_14-ev-flexibility_28_0.png" src="../_images/tutorials_14-ev-flexibility_28_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

EV Contribution to Total Load:
  EV share of total energy: 4.3%
  Peak coincidence factor: 1.00
</pre></div></div>
</div>
</section>
<section id="10.-Configuration-Reference">
<h2>10. Configuration Reference<a class="headerlink" href="#10.-Configuration-Reference" title="Link to this heading">#</a></h2>
<p>EV flexibility is configured in <code class="docutils literal notranslate"><span class="pre">config/defaults.yaml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">electric_vehicles</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">tariff</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;V2G&quot;</span><span class="w">               </span><span class="c1"># GO, INT, V2G, or MIXED</span>

<span class="w">  </span><span class="c1"># Flex share: Fraction of EVs with smart charging capability</span>
<span class="w">  </span><span class="nt">flex_share</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0</span><span class="w">              </span><span class="c1"># 1.0 = all EVs, 0.2 = only 20%</span>

<span class="w">  </span><span class="c1"># Spatial allocation method</span>
<span class="w">  </span><span class="nt">allocation_method</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;proportional&quot;</span><span class="w">  </span><span class="c1"># proportional, uniform, or urban_weighted</span>

<span class="w">  </span><span class="c1"># Fleet characteristics</span>
<span class="w">  </span><span class="nt">battery_capacity_kwh</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">60.0</span><span class="w">   </span><span class="c1"># Average EV battery size</span>
<span class="w">  </span><span class="nt">charge_efficiency</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.90</span><span class="w">      </span><span class="c1"># Grid-to-battery efficiency</span>
<span class="w">  </span><span class="nt">charger_power_kw</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7.0</span><span class="w">        </span><span class="c1"># Home charger power</span>

<span class="w">  </span><span class="c1"># Availability profile</span>
<span class="w">  </span><span class="nt">use_traffic_data</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">       </span><span class="c1"># Use inverse of traffic for availability</span>
<span class="w">  </span><span class="nt">min_availability</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.5</span><span class="w">        </span><span class="c1"># Minimum plugged-in fraction during commute</span>
<span class="w">  </span><span class="nt">max_availability</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.95</span><span class="w">       </span><span class="c1"># Maximum plugged-in fraction overnight</span>

<span class="w">  </span><span class="c1"># V2G settings (when tariff: &quot;V2G&quot;)</span>
<span class="w">  </span><span class="nt">v2g</span><span class="p">:</span>
<span class="w">    </span><span class="nt">use_fes_capacity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">     </span><span class="c1"># Use FES Srg_BB005 V2G capacity</span>
<span class="w">    </span><span class="nt">discharge_efficiency</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.90</span><span class="w"> </span><span class="c1"># Battery-to-grid efficiency</span>
<span class="w">    </span><span class="nt">degradation_cost_per_mwh</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50.0</span><span class="w">  </span><span class="c1"># Battery wear cost (£/MWh)</span>

<span class="w">  </span><span class="c1"># MIXED tariff shares (when tariff: &quot;MIXED&quot;)</span>
<span class="w">  </span><span class="nt">mixed_tariff_shares</span><span class="p">:</span>
<span class="w">    </span><span class="nt">go_share</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.5</span>
<span class="w">    </span><span class="nt">int_share</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.3</span>
<span class="w">    </span><span class="nt">v2g_share</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.2</span>
</pre></div>
</div>
<section id="Key-Parameters:">
<h3>Key Parameters:<a class="headerlink" href="#Key-Parameters:" title="Link to this heading">#</a></h3>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Typical Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">tariff</span></code></p></td>
<td><p>Flexibility mode</p></td>
<td><p>GO, INT, V2G, MIXED</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">flex_share</span></code></p></td>
<td><p>Fraction of EVs participating in flexibility</p></td>
<td><p>0.1-1.0</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">allocation_method</span></code></p></td>
<td><p>How to distribute EVs geographically</p></td>
<td><p>proportional</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">battery_capacity_kwh</span></code></p></td>
<td><p>Average EV battery size</p></td>
<td><p>40-100 kWh</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">charge_efficiency</span></code></p></td>
<td><p>Charging efficiency</p></td>
<td><p>0.85-0.95</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">charger_power_kw</span></code></p></td>
<td><p>Home charger power</p></td>
<td><p>3.5-22 kW</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">use_fes_capacity</span></code></p></td>
<td><p>Use FES V2G capacity projection</p></td>
<td><p>true/false</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">degradation_cost_per_mwh</span></code></p></td>
<td><p>Battery cycling cost</p></td>
<td><p>30-100 £/MWh</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">min_availability</span></code></p></td>
<td><p>Min plugged-in fraction (commute)</p></td>
<td><p>0.4-0.6</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">max_availability</span></code></p></td>
<td><p>Max plugged-in fraction (overnight)</p></td>
<td><p>0.9-1.0</p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<section id="11.-Advanced-Features">
<h2>11. Advanced Features<a class="headerlink" href="#11.-Advanced-Features" title="Link to this heading">#</a></h2>
<section id="11.1-Spatial-Allocation-Methods">
<h3>11.1 Spatial Allocation Methods<a class="headerlink" href="#11.1-Spatial-Allocation-Methods" title="Link to this heading">#</a></h3>
<p>PyPSA-GB provides three methods for allocating EV demand across network buses:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Method</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Use Case</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>proportional</strong></p></td>
<td><p>Allocates based on existing demand</p></td>
<td><p>Default - preserves demand patterns</p></td>
</tr>
<tr class="row-odd"><td><p><strong>uniform</strong></p></td>
<td><p>Equal distribution across all buses</p></td>
<td><p>Testing/sensitivity</p></td>
</tr>
<tr class="row-even"><td><p><strong>urban_weighted</strong></p></td>
<td><p>Concentrates EVs in high-demand areas</p></td>
<td><p>Realistic urban concentration</p></td>
</tr>
</tbody>
</table>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">electric_vehicles</span><span class="p">:</span>
<span class="w">  </span><span class="nt">allocation_method</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;proportional&quot;</span><span class="w">  </span><span class="c1"># or &quot;uniform&quot; or &quot;urban_weighted&quot;</span>
</pre></div>
</div>
<p>The <strong>urban_weighted</strong> method uses a power function (exponent 2.0) to concentrate EVs in high-demand (urban) areas, reflecting the reality that EV adoption is higher in cities.</p>
</section>
<section id="11.2-MIXED-Tariff-Mode">
<h3>11.2 MIXED Tariff Mode<a class="headerlink" href="#11.2-MIXED-Tariff-Mode" title="Link to this heading">#</a></h3>
<p>The <strong>MIXED</strong> mode allows different EVs to use different tariff types at the same bus. For example:</p>
<ul class="simple">
<li><p>50% on GO tariff (fixed window)</p></li>
<li><p>30% on INT tariff (smart charging)</p></li>
<li><p>20% on V2G tariff (bidirectional)</p></li>
</ul>
<p>This reflects real-world heterogeneity where not all EV owners have the same charging infrastructure or willingness to participate in V2G.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">electric_vehicles</span><span class="p">:</span>
<span class="w">  </span><span class="nt">tariff</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;MIXED&quot;</span>
<span class="w">  </span><span class="nt">mixed_tariff_shares</span><span class="p">:</span>
<span class="w">    </span><span class="nt">go_share</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.5</span>
<span class="w">    </span><span class="nt">int_share</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.3</span>
<span class="w">    </span><span class="nt">v2g_share</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.2</span>
</pre></div>
</div>
<p>The shares must sum to 1.0. MIXED mode creates separate Store and Link components for each tariff type at each bus.</p>
</section>
<section id="11.3-Flexibility-Share-(flex_share)">
<h3>11.3 Flexibility Share (<code class="docutils literal notranslate"><span class="pre">flex_share</span></code>)<a class="headerlink" href="#11.3-Flexibility-Share-(flex_share)" title="Link to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">flex_share</span></code> parameter controls what fraction of the EV fleet participates in flexibility:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">electric_vehicles</span><span class="p">:</span>
<span class="w">  </span><span class="nt">flex_share</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.2</span><span class="w">  </span><span class="c1"># Only 20% of EVs have smart chargers</span>
</pre></div>
</div>
<p><strong>How it works:</strong></p>
<ul class="simple">
<li><p><strong>flex_share × EVs</strong> get Store + Link components (smart charging)</p></li>
<li><p><strong>(1 - flex_share) × EVs</strong> remain as dumb loads on main grid</p></li>
</ul>
<p>For example, with <code class="docutils literal notranslate"><span class="pre">flex_share:</span> <span class="pre">0.2</span></code>:</p>
<ul class="simple">
<li><p>20% of EV demand → EV battery buses with smart charging</p></li>
<li><p>80% of EV demand → regular loads with typical evening peak profile</p></li>
</ul>
<p>This is important for modeling realistic adoption rates where not all EV owners have smart chargers or participate in V2G programs.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Analyze flex_share: where did the 80% dumb EV demand go?</span>
<span class="c1"># In the solved network, dumb EV loads (carrier=&#39;electric_vehicles&#39;) get merged</span>
<span class="c1"># into &#39;electricity&#39; loads during network clustering/aggregation.</span>
<span class="c1"># We can verify this by checking the pre-clustering network.</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FLEX_SHARE ANALYSIS&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>

<span class="c1"># Check pre-clustering network to see the split</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">n_pre</span> <span class="o">=</span> <span class="n">pypsa</span><span class="o">.</span><span class="n">Network</span><span class="p">(</span>
        <span class="s2">&quot;../../../resources/network/HT35_flex_network_demand_renewables_thermal&quot;</span>
        <span class="s2">&quot;_generators_storage_hydrogen_interconnectors.nc&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Before clustering, we can see all three load carriers</span>
    <span class="n">elec_pre</span> <span class="o">=</span> <span class="n">n_pre</span><span class="o">.</span><span class="n">loads</span><span class="p">[</span><span class="n">n_pre</span><span class="o">.</span><span class="n">loads</span><span class="o">.</span><span class="n">carrier</span> <span class="o">==</span> <span class="s1">&#39;electricity&#39;</span><span class="p">]</span>
    <span class="n">dumb_ev_pre</span> <span class="o">=</span> <span class="n">n_pre</span><span class="o">.</span><span class="n">loads</span><span class="p">[</span><span class="n">n_pre</span><span class="o">.</span><span class="n">loads</span><span class="o">.</span><span class="n">carrier</span> <span class="o">==</span> <span class="s1">&#39;electric_vehicles&#39;</span><span class="p">]</span>
    <span class="n">flex_ev_pre</span> <span class="o">=</span> <span class="n">n_pre</span><span class="o">.</span><span class="n">loads</span><span class="p">[</span><span class="n">n_pre</span><span class="o">.</span><span class="n">loads</span><span class="o">.</span><span class="n">carrier</span> <span class="o">==</span> <span class="s1">&#39;EV driving&#39;</span><span class="p">]</span>

    <span class="n">elec_gwh</span> <span class="o">=</span> <span class="n">n_pre</span><span class="o">.</span><span class="n">loads_t</span><span class="o">.</span><span class="n">p_set</span><span class="p">[</span><span class="n">elec_pre</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">n_pre</span><span class="o">.</span><span class="n">loads_t</span><span class="o">.</span><span class="n">p_set</span><span class="o">.</span><span class="n">columns</span><span class="p">)]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span>
    <span class="n">dumb_gwh</span> <span class="o">=</span> <span class="n">n_pre</span><span class="o">.</span><span class="n">loads_t</span><span class="o">.</span><span class="n">p_set</span><span class="p">[</span><span class="n">dumb_ev_pre</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">n_pre</span><span class="o">.</span><span class="n">loads_t</span><span class="o">.</span><span class="n">p_set</span><span class="o">.</span><span class="n">columns</span><span class="p">)]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span>
    <span class="n">flex_gwh</span> <span class="o">=</span> <span class="n">n_pre</span><span class="o">.</span><span class="n">loads_t</span><span class="o">.</span><span class="n">p_set</span><span class="p">[</span><span class="n">flex_ev_pre</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">n_pre</span><span class="o">.</span><span class="n">loads_t</span><span class="o">.</span><span class="n">p_set</span><span class="o">.</span><span class="n">columns</span><span class="p">)]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span>
    <span class="n">total_ev_gwh</span> <span class="o">=</span> <span class="n">dumb_gwh</span> <span class="o">+</span> <span class="n">flex_gwh</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">PRE-CLUSTERING DEMAND (annual, full year):&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Base electricity:       </span><span class="si">{</span><span class="n">elec_gwh</span><span class="si">:</span><span class="s2">&gt;10,.1f</span><span class="si">}</span><span class="s2"> GWh&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Dumb EV charging (80%): </span><span class="si">{</span><span class="n">dumb_gwh</span><span class="si">:</span><span class="s2">&gt;10,.1f</span><span class="si">}</span><span class="s2"> GWh  ← carrier=&#39;electric_vehicles&#39;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Smart EV driving (20%): </span><span class="si">{</span><span class="n">flex_gwh</span><span class="si">:</span><span class="s2">&gt;10,.1f</span><span class="si">}</span><span class="s2"> GWh  ← carrier=&#39;EV driving&#39;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total EV demand:        </span><span class="si">{</span><span class="n">total_ev_gwh</span><span class="si">:</span><span class="s2">&gt;10,.1f</span><span class="si">}</span><span class="s2"> GWh&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Effective flex_share:   </span><span class="si">{</span><span class="n">flex_gwh</span><span class="o">/</span><span class="n">total_ev_gwh</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">AFTER CLUSTERING (merged):&quot;</span><span class="p">)</span>
    <span class="c1"># In clustered network, dumb EV loads merge into &#39;electricity&#39;</span>
    <span class="n">elec_clust</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">loads</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">loads</span><span class="o">.</span><span class="n">carrier</span> <span class="o">==</span> <span class="s1">&#39;electricity&#39;</span><span class="p">]</span>
    <span class="n">elec_clust_gwh</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">loads_t</span><span class="o">.</span><span class="n">p_set</span><span class="p">[</span><span class="n">elec_clust</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span>
    <span class="n">flex_clust_gwh</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">loads_t</span><span class="o">.</span><span class="n">p_set</span><span class="p">[</span><span class="n">ev_loads</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  &#39;electricity&#39; loads:    </span><span class="si">{</span><span class="n">elec_clust_gwh</span><span class="si">:</span><span class="s2">&gt;10,.1f</span><span class="si">}</span><span class="s2"> GWh  (includes base + 80% dumb EVs)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  &#39;EV driving&#39; loads:     </span><span class="si">{</span><span class="n">flex_clust_gwh</span><span class="si">:</span><span class="s2">&gt;10,.1f</span><span class="si">}</span><span class="s2"> GWh  (20% flexible EVs)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Expected electricity:   </span><span class="si">{</span><span class="p">(</span><span class="n">elec_gwh</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dumb_gwh</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">snapshots</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">8760</span><span class="si">:</span><span class="s2">&gt;10,.1f</span><span class="si">}</span><span class="s2"> GWh (scaled to solve period)&quot;</span><span class="p">)</span>

    <span class="k">del</span> <span class="n">n_pre</span>  <span class="c1"># Free memory</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not load pre-clustering network: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Using solved network data only:&quot;</span><span class="p">)</span>
    <span class="n">ev_loads</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">loads</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">loads</span><span class="o">.</span><span class="n">carrier</span> <span class="o">==</span> <span class="s1">&#39;EV driving&#39;</span><span class="p">]</span>
    <span class="n">flex_gwh</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">loads_t</span><span class="o">.</span><span class="n">p_set</span><span class="p">[</span><span class="n">ev_loads</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Smart EV driving: </span><span class="si">{</span><span class="n">flex_gwh</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> GWh (flex_share=</span><span class="si">{</span><span class="n">eff_flex_share</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Dumb EV charging: embedded in &#39;electricity&#39; loads after clustering&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
============================================================
FLEX_SHARE ANALYSIS
============================================================
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:pypsa.network.io:Imported network &#39;ETYS base + upgrades (2035)&#39; has buses, carriers, generators, lines, links, loads, storage_units, stores, transformers
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

PRE-CLUSTERING DEMAND (annual, full year):
  Base electricity:        221,151.5 GWh
  Dumb EV charging (80%):   51,074.1 GWh  ← carrier=&#39;electric_vehicles&#39;
  Smart EV driving (20%):   12,869.2 GWh  ← carrier=&#39;EV driving&#39;
  Total EV demand:          63,943.3 GWh
  Effective flex_share:   0.20

AFTER CLUSTERING (merged):
  &#39;electricity&#39; loads:       6,013.5 GWh  (includes base + 80% dumb EVs)
  &#39;EV driving&#39; loads:          246.7 GWh  (20% flexible EVs)
  Expected electricity:      5,220.8 GWh (scaled to solve period)
</pre></div></div>
</div>
</section>
<section id="11.4-EV-Driving-Profiles">
<h3>11.4 EV Driving Profiles<a class="headerlink" href="#11.4-EV-Driving-Profiles" title="Link to this heading">#</a></h3>
<p>EV electricity demand follows traffic patterns with distinct peaks during commute times. PyPSA-GB uses a multi-modal synthetic profile with:</p>
<ul class="simple">
<li><p><strong>Morning peak</strong>: 08:00 (commute to work)</p></li>
<li><p><strong>Midday activity</strong>: 10:00-16:00 (lunch, errands)</p></li>
<li><p><strong>Evening peak</strong>: 18:00 (commute home)</p></li>
</ul>
<p>This creates a realistic 2.8x peak-to-mean ratio, much more realistic than older single-peak profiles that concentrated all demand in a 4-hour window.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualize EV driving profile in detail</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ev_loads</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">driving_profile</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">loads_t</span><span class="o">.</span><span class="n">p_set</span><span class="p">[</span><span class="n">ev_loads</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span>  <span class="c1"># GW</span>

    <span class="c1"># Daily average pattern</span>
    <span class="n">driving_by_hour</span> <span class="o">=</span> <span class="n">driving_profile</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">driving_profile</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

    <span class="c1"># Hourly bar chart with annotations</span>
    <span class="n">bars</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">driving_by_hour</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">driving_by_hour</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">driving_by_hour</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mean: </span><span class="si">{</span><span class="n">driving_by_hour</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> GW&#39;</span><span class="p">)</span>

    <span class="c1"># Highlight peak hours</span>
    <span class="n">peak_hours</span> <span class="o">=</span> <span class="n">driving_by_hour</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">hour</span> <span class="ow">in</span> <span class="n">peak_hours</span><span class="p">:</span>
        <span class="n">bars</span><span class="p">[</span><span class="n">hour</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="n">bars</span><span class="p">[</span><span class="n">hour</span><span class="p">]</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mf">0.8</span><span class="p">)</span>

    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Average Driving Demand (GW)&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Hour of Day&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Average Daily EV Driving Profile&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># Add peak annotations</span>
    <span class="k">for</span> <span class="n">hour</span> <span class="ow">in</span> <span class="n">peak_hours</span><span class="p">:</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">driving_by_hour</span><span class="p">[</span><span class="n">hour</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> GW</span><span class="se">\n</span><span class="s1">(commute peak)&#39;</span><span class="p">,</span>
                        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">hour</span><span class="p">,</span> <span class="n">driving_by_hour</span><span class="p">[</span><span class="n">hour</span><span class="p">]),</span>
                        <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">hour</span><span class="p">,</span> <span class="n">driving_by_hour</span><span class="p">[</span><span class="n">hour</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">),</span>
                        <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span>
                        <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round,pad=0.3&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">))</span>

    <span class="c1"># Full week time series</span>
    <span class="n">week_data</span> <span class="o">=</span> <span class="n">driving_profile</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">168</span><span class="p">]</span>  <span class="c1"># First week</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">week_data</span><span class="p">)),</span> <span class="n">week_data</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">week_data</span><span class="p">)),</span> <span class="n">week_data</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">driving_profile</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                   <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mean: </span><span class="si">{</span><span class="n">driving_profile</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> GW&#39;</span><span class="p">)</span>

    <span class="c1"># Mark weekdays</span>
    <span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">168</span><span class="p">,</span> <span class="mi">24</span><span class="p">):</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">day</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">day_name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Mon&#39;</span><span class="p">,</span> <span class="s1">&#39;Tue&#39;</span><span class="p">,</span> <span class="s1">&#39;Wed&#39;</span><span class="p">,</span> <span class="s1">&#39;Thu&#39;</span><span class="p">,</span> <span class="s1">&#39;Fri&#39;</span><span class="p">,</span> <span class="s1">&#39;Sat&#39;</span><span class="p">,</span> <span class="s1">&#39;Sun&#39;</span><span class="p">][</span><span class="n">day</span><span class="o">//</span><span class="mi">24</span><span class="p">]</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">day</span> <span class="o">+</span> <span class="mi">12</span><span class="p">,</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">day_name</span><span class="p">,</span>
                    <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>

    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;EV Driving Demand (GW)&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Hour of Week&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;EV Driving Profile - First Week&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># Statistics</span>
    <span class="n">peak_mean_ratio</span> <span class="o">=</span> <span class="n">driving_profile</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">/</span> <span class="n">driving_profile</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Driving Profile Statistics:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Peak: </span><span class="si">{</span><span class="n">driving_profile</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> GW at hour </span><span class="si">{</span><span class="n">driving_profile</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span><span class="o">.</span><span class="n">hour</span><span class="si">}</span><span class="s2">:00&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Mean: </span><span class="si">{</span><span class="n">driving_profile</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> GW&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Peak/Mean ratio: </span><span class="si">{</span><span class="n">peak_mean_ratio</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">x&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Peak hours: </span><span class="si">{</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">h</span><span class="si">:</span><span class="s1">02d</span><span class="si">}</span><span class="s1">:00&#39;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">peak_hours</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No EV driving loads found&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_14-ev-flexibility_35_0.png" src="../_images/tutorials_14-ev-flexibility_35_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Driving Profile Statistics:
  Peak: 4.09 GW at hour 8:00
  Mean: 1.47 GW
  Peak/Mean ratio: 2.79x
  Peak hours: [&#39;08:00&#39;, &#39;18:00&#39;]
</pre></div></div>
</div>
</section>
<section id="11.5-EV-Components-Architecture">
<h3>11.5 EV Components Architecture<a class="headerlink" href="#11.5-EV-Components-Architecture" title="Link to this heading">#</a></h3>
<p>Understanding the PyPSA components created for EV flexibility:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Main Grid Bus (e.g., &quot;ABCD1&quot;)
    │
    ├─ Load: &quot;electric_vehicles&quot; (dumb charging, if flex_share &lt; 1.0)
    │
    └─ Link: &quot;EV_charger_ABCD1_GO&quot; (or INT/V2G)
            │ efficiency = 0.90 (charger efficiency)
            │ p_max_pu = availability profile (0.5-0.95)
            ↓
       EV Battery Bus: &quot;ABCD1_ev_battery_GO&quot;
            │
            ├─ Store: &quot;EV_battery_ABCD1_GO&quot;
            │       e_nom = battery capacity (MWh)
            │       e_min_pu = 0.2 (minimum 20% SOC)
            │       e_max_pu = 1.0 (full charge)
            │
            ├─ Load: &quot;EV_driving_ABCD1_GO&quot;
            │       p_set = driving demand profile
            │
            └─ Link: &quot;V2G_ABCD1&quot; (V2G mode only)
                    │ efficiency = 0.90
                    │ marginal_cost = 50 £/MWh (degradation)
                    ↓
               Back to Main Grid Bus
</pre></div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Each tariff mode creates a separate EV battery bus</p></li>
<li><p>Store tracks state of charge over time</p></li>
<li><p>Charger Link limits charging based on availability</p></li>
<li><p>V2G adds reverse Link with degradation cost</p></li>
<li><p>MIXED mode creates multiple sets of components per bus</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Examine component details at a sample bus</span>

<span class="c1"># Find a bus with EV components</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ev_stores</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="c1"># Get a sample EV store and its bus</span>
    <span class="n">sample_store</span> <span class="o">=</span> <span class="n">ev_stores</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ev_bus</span> <span class="o">=</span> <span class="n">sample_store</span><span class="o">.</span><span class="n">name</span>  <span class="c1"># Store name is the bus name</span>

    <span class="c1"># Find the parent grid bus (EV bus ends with _ev_battery_...)</span>
    <span class="c1"># Extract grid bus name from EV bus</span>
    <span class="n">grid_bus</span> <span class="o">=</span> <span class="n">ev_bus</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_ev_battery&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">70</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;EV COMPONENTS AT BUS: </span><span class="si">{</span><span class="n">grid_bus</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">70</span><span class="p">)</span>

    <span class="c1"># Find all EV-related components at this bus</span>

    <span class="c1"># 1. Charger Link (grid → EV battery)</span>
    <span class="n">charger_links</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">links</span><span class="p">[(</span><span class="n">n</span><span class="o">.</span><span class="n">links</span><span class="o">.</span><span class="n">bus0</span> <span class="o">==</span> <span class="n">grid_bus</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">links</span><span class="o">.</span><span class="n">bus1</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;ev_battery&#39;</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">))]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">charger_links</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">1. CHARGER LINK(S): </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">charger_links</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">charger_links</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     Carrier: </span><span class="si">{</span><span class="n">link</span><span class="p">[</span><span class="s1">&#39;carrier&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     Capacity: </span><span class="si">{</span><span class="n">link</span><span class="p">[</span><span class="s1">&#39;p_nom&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MW&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     Efficiency: </span><span class="si">{</span><span class="n">link</span><span class="p">[</span><span class="s1">&#39;efficiency&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">n</span><span class="o">.</span><span class="n">links_t</span><span class="o">.</span><span class="n">p_max_pu</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">avail</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">links_t</span><span class="o">.</span><span class="n">p_max_pu</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     Availability: </span><span class="si">{</span><span class="n">avail</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">avail</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># 2. EV Battery Store</span>
    <span class="n">ev_stores_at_bus</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">stores</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">stores</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="n">ev_bus</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ev_stores_at_bus</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">2. BATTERY STORE(S): </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">ev_stores_at_bus</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">store</span> <span class="ow">in</span> <span class="n">ev_stores_at_bus</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     Carrier: </span><span class="si">{</span><span class="n">store</span><span class="p">[</span><span class="s1">&#39;carrier&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     Capacity: </span><span class="si">{</span><span class="n">store</span><span class="p">[</span><span class="s1">&#39;e_nom&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MWh&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     Min SOC: </span><span class="si">{</span><span class="n">store</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;e_min_pu&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     Max SOC: </span><span class="si">{</span><span class="n">store</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;e_max_pu&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

    <span class="c1"># 3. Driving Loads</span>
    <span class="n">driving_loads_at_bus</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">loads</span><span class="p">[(</span><span class="n">n</span><span class="o">.</span><span class="n">loads</span><span class="o">.</span><span class="n">bus</span> <span class="o">==</span> <span class="n">ev_bus</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">loads</span><span class="o">.</span><span class="n">carrier</span> <span class="o">==</span> <span class="s1">&#39;EV driving&#39;</span><span class="p">)]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">driving_loads_at_bus</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">3. DRIVING LOAD(S): </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">driving_loads_at_bus</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">load</span> <span class="ow">in</span> <span class="n">driving_loads_at_bus</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">total_demand</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">loads_t</span><span class="o">.</span><span class="n">p_set</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">if</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">n</span><span class="o">.</span><span class="n">loads_t</span><span class="o">.</span><span class="n">p_set</span><span class="o">.</span><span class="n">columns</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     Carrier: </span><span class="si">{</span><span class="n">load</span><span class="p">[</span><span class="s1">&#39;carrier&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     Total weekly demand: </span><span class="si">{</span><span class="n">total_demand</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> MWh&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     Peak demand: </span><span class="si">{</span><span class="n">n</span><span class="o">.</span><span class="n">loads_t</span><span class="o">.</span><span class="n">p_set</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MW&quot;</span><span class="p">)</span>

    <span class="c1"># 4. V2G Link (if present)</span>
    <span class="n">v2g_at_bus</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">links</span><span class="p">[(</span><span class="n">n</span><span class="o">.</span><span class="n">links</span><span class="o">.</span><span class="n">bus0</span> <span class="o">==</span> <span class="n">ev_bus</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">links</span><span class="o">.</span><span class="n">bus1</span> <span class="o">==</span> <span class="n">grid_bus</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">links</span><span class="o">.</span><span class="n">carrier</span> <span class="o">==</span> <span class="s1">&#39;V2G&#39;</span><span class="p">)]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v2g_at_bus</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">4. V2G LINK(S): </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">v2g_at_bus</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">v2g_at_bus</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     Capacity: </span><span class="si">{</span><span class="n">link</span><span class="p">[</span><span class="s1">&#39;p_nom&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MW&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     Efficiency: </span><span class="si">{</span><span class="n">link</span><span class="p">[</span><span class="s1">&#39;efficiency&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     Degradation cost: £</span><span class="si">{</span><span class="n">link</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;marginal_cost&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">/MWh&quot;</span><span class="p">)</span>

    <span class="c1"># 5. Dumb EV loads (if flex_share &lt; 1.0)</span>
    <span class="n">dumb_loads_at_bus</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">loads</span><span class="p">[(</span><span class="n">n</span><span class="o">.</span><span class="n">loads</span><span class="o">.</span><span class="n">bus</span> <span class="o">==</span> <span class="n">grid_bus</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">loads</span><span class="o">.</span><span class="n">carrier</span> <span class="o">==</span> <span class="s1">&#39;electric_vehicles&#39;</span><span class="p">)]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dumb_loads_at_bus</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">5. DUMB EV LOAD(S): </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">dumb_loads_at_bus</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">load</span> <span class="ow">in</span> <span class="n">dumb_loads_at_bus</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">total_demand</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">loads_t</span><span class="o">.</span><span class="n">p_set</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">if</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">n</span><span class="o">.</span><span class="n">loads_t</span><span class="o">.</span><span class="n">p_set</span><span class="o">.</span><span class="n">columns</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     Total weekly demand: </span><span class="si">{</span><span class="n">total_demand</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> MWh&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     (This is the non-flexible portion)&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">70</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No EV stores found in network&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
======================================================================
EV COMPONENTS AT BUS: CLAC1Q EV fleet battery GO
======================================================================

2. BATTERY STORE(S): 1
   CLAC1Q EV fleet battery GO
     Carrier: EV battery
     Capacity: 0.96 MWh
     Min SOC: 20%
     Max SOC: 100%

======================================================================
</pre></div></div>
</div>
</section>
</section>
<section id="12.-Comparing-Scenarios-&amp;-Understanding-Value">
<h2>12. Comparing Scenarios &amp; Understanding Value<a class="headerlink" href="#12.-Comparing-Scenarios-&-Understanding-Value" title="Link to this heading">#</a></h2>
<p>To understand the value of EV flexibility, you can compare scenarios with different tariff modes:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Scenario</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Expected Results</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>No flex</strong></p></td>
<td><p>EVs as dumb loads</p></td>
<td><p>High evening peak, no system services</p></td>
</tr>
<tr class="row-odd"><td><p><strong>GO</strong></p></td>
<td><p>Fixed night window</p></td>
<td><p>Peak shifted but not optimized</p></td>
</tr>
<tr class="row-even"><td><p><strong>INT</strong></p></td>
<td><p>Smart charging</p></td>
<td><p>Optimized charging timing, lower costs</p></td>
</tr>
<tr class="row-odd"><td><p><strong>V2G</strong></p></td>
<td><p>Bidirectional</p></td>
<td><p>Additional grid services, highest value</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Value of flexibility comes from:</strong></p>
<ol class="arabic simple">
<li><p><strong>Peak shaving</strong>: Reducing evening demand peaks (£100-200/MWh avoided)</p></li>
<li><p><strong>Renewable integration</strong>: Charging when wind/solar abundant (£30-50/MWh)</p></li>
<li><p><strong>Grid services (V2G)</strong>: Providing balancing during stress (£100-300/MWh)</p></li>
<li><p><strong>Transmission relief</strong>: Distributing load temporally reduces network congestion</p></li>
</ol>
<p><strong>Trade-offs:</strong></p>
<ul class="simple">
<li><p><strong>GO</strong>: Simple but inflexible (fixed window may not align with cheap power)</p></li>
<li><p><strong>INT</strong>: Good balance of value and simplicity</p></li>
<li><p><strong>V2G</strong>: Highest value but requires bidirectional chargers + degradation costs</p></li>
<li><p><strong>MIXED</strong>: Most realistic but more complex to model</p></li>
</ul>
</section>
<section id="13.-Summary-&amp;-Key-Takeaways">
<h2>13. Summary &amp; Key Takeaways<a class="headerlink" href="#13.-Summary-&-Key-Takeaways" title="Link to this heading">#</a></h2>
<section id="Key-Takeaways:">
<h3>Key Takeaways:<a class="headerlink" href="#Key-Takeaways:" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p><strong>EV flexibility provides significant grid value</strong> through:</p>
<ul class="simple">
<li><p>Peak demand reduction (smart charging shifts load overnight)</p></li>
<li><p>Grid balancing services (V2G discharges during stress periods)</p></li>
<li><p>Renewable integration (charge when wind/solar abundant)</p></li>
<li><p>Network congestion relief (temporal load distribution)</p></li>
</ul>
</li>
<li><p><strong>Four tariff modes offer different flexibility levels</strong>:</p>
<ul class="simple">
<li><p><strong>GO</strong>: Simple time shift to fixed 4-hour window (00:00-04:00)</p></li>
<li><p><strong>INT</strong>: Full optimization of charging timing</p></li>
<li><p><strong>V2G</strong>: Bidirectional including grid export</p></li>
<li><p><strong>MIXED</strong>: Heterogeneous fleet with different tariff types per bus</p></li>
</ul>
</li>
<li><p><strong>Spatial allocation methods</strong> control geographic distribution:</p>
<ul class="simple">
<li><p><strong>proportional</strong>: Preserves existing demand patterns (default)</p></li>
<li><p><strong>uniform</strong>: Equal distribution for testing</p></li>
<li><p><strong>urban_weighted</strong>: Concentrates EVs in high-demand (urban) areas</p></li>
</ul>
</li>
<li><p><strong>flex_share is the key parameter</strong> (default 0.2 = 20%):</p>
<ul class="simple">
<li><p>Controls demand split: 20% flexible, 80% dumb</p></li>
<li><p>Dumb loads merge into base ‘electricity’ during clustering</p></li>
<li><p>Flexible portion gets optimizable Store + Link components</p></li>
</ul>
</li>
<li><p><strong>Hardware capacities from FES building blocks</strong>:</p>
<ul class="simple">
<li><p>V2G: FES Srg_BB005 (~17.9 GW for HT 2035)</p></li>
<li><p>Smart charging: FES Srg_BB007a</p></li>
<li><p>Scaled by: flex_share × MIXED mode tariff shares</p></li>
<li><p>Battery degradation cost (£50/MWh) limits V2G cycling</p></li>
</ul>
</li>
<li><p><strong>Multi-modal driving profile</strong> reflects realistic traffic:</p>
<ul class="simple">
<li><p>Morning peak (08:00) + Evening peak (18:00)</p></li>
<li><p>Midday activity for errands</p></li>
<li><p>2.8x peak-to-mean ratio (much better than old 5.5x single-peak)</p></li>
</ul>
</li>
<li><p><strong>PyPSA components for EV flexibility</strong>:</p>
<ul class="simple">
<li><p><strong>Store</strong> (EV battery): Tracks SOC, enforces capacity limits</p></li>
<li><p><strong>Link</strong> (EV charger): Connects grid to battery with efficiency + availability</p></li>
<li><p><strong>Link</strong> (V2G): Connects battery back to grid for discharge</p></li>
<li><p><strong>Load</strong> (EV driving): Fixed demand for vehicle operation</p></li>
<li><p><strong>Load</strong> (dumb EVs): Non-flexible portion, merged into ‘electricity’ during clustering</p></li>
</ul>
</li>
</ol>
</section>
<section id="Further-Exploration">
<h3>Further Exploration<a class="headerlink" href="#Further-Exploration" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Try different <code class="docutils literal notranslate"><span class="pre">flex_share</span></code> values (0.2, 0.5, 1.0) to see adoption rate impacts</p></li>
<li><p>Compare GO vs INT vs V2G costs and load profiles</p></li>
<li><p>Examine V2G dispatch during different weather/demand conditions</p></li>
<li><p>Analyze network congestion with/without EV smart charging</p></li>
<li><p>Test sensitivity to <code class="docutils literal notranslate"><span class="pre">degradation_cost_per_mwh</span></code> in V2G scenarios</p></li>
</ul>
</section>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="13-heat-flexibility.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Heat Pump Flexibility</p>
      </div>
    </a>
    <a class="right-next"
       href="15-demand-side-response.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Demand Side Response</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#What-You'll-Learn.">What You’ll Learn.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#1.-Setup">1. Setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#2.-Background:-Why-EV-Flexibility-Matters">2. Background: Why EV Flexibility Matters</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#2.1-How-PyPSA-GB-Models-EV-Flexibility">2.1 How PyPSA-GB Models EV Flexibility</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#2.2-Four-EV-Tariff-Modes">2.2 Four EV Tariff Modes</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#GO-Mode-(Octopus-Go-Style)">GO Mode (Octopus Go Style)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#INT-Mode-(Intelligent-Tariff)">INT Mode (Intelligent Tariff)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#V2G-Mode-(Vehicle-to-Grid)">V2G Mode (Vehicle-to-Grid)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#MIXED-Mode-(HT35_flex-uses-this)">MIXED Mode (HT35_flex uses this)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#3.-Load-a-Network-with-EV-Flexibility">3. Load a Network with EV Flexibility</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#4.-EV-Components-in-the-Network">4. EV Components in the Network</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#4.1-Identifying-EV-Components">4.1 Identifying EV Components</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#4.2-EV-Capacity-Summary">4.2 EV Capacity Summary</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#5.-EV-Availability-Profile">5. EV Availability Profile</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#6.-Analyzing-EV-Charging-Behavior">6. Analyzing EV Charging Behavior</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#6.1-Total-EV-Charging-Profile">6.1 Total EV Charging Profile</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#6.2-Daily-Charging-Pattern">6.2 Daily Charging Pattern</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#7.-V2G-Dispatch-Analysis">7. V2G Dispatch Analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#7.1-V2G-Value-Analysis">7.1 V2G Value Analysis</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#8.-Battery-State-of-Charge">8. Battery State of Charge</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#9.-EV-Impact-on-Grid">9. EV Impact on Grid</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#10.-Configuration-Reference">10. Configuration Reference</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Key-Parameters:">Key Parameters:</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#11.-Advanced-Features">11. Advanced Features</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#11.1-Spatial-Allocation-Methods">11.1 Spatial Allocation Methods</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#11.2-MIXED-Tariff-Mode">11.2 MIXED Tariff Mode</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#11.3-Flexibility-Share-(flex_share)">11.3 Flexibility Share (<code class="docutils literal notranslate"><span class="pre">flex_share</span></code>)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#11.4-EV-Driving-Profiles">11.4 EV Driving Profiles</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#11.5-EV-Components-Architecture">11.5 EV Components Architecture</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#12.-Comparing-Scenarios-&amp;-Understanding-Value">12. Comparing Scenarios &amp; Understanding Value</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#13.-Summary-&amp;-Key-Takeaways">13. Summary &amp; Key Takeaways</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Key-Takeaways:">Key Takeaways:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Further-Exploration">Further Exploration</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2021-2026, Andrew Lyden, University of Edinburgh.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__center">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2021-2026, Andrew Lyden, University of Edinburgh.
      <br/>
    
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.4.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>